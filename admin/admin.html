<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - BuildRite</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <style>
    /* PASTE THE CSS FROM PART 2 HERE */

    body {
      background-color: #f4f6f9;
      font-family: 'Segoe UI', sans-serif;
      transition: background 0.3s, color 0.3s;
    }
    .container {
      max-width: 1100px;
      margin-top: 2rem;
    }
    .table th {
      background-color: #2f6fd3;
      color: white;
    }
    .table img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 5px;
    }
    .search-bar {
      margin-bottom: 1rem;
    }
    .btn-action {
        margin-right: 5px;
    }
    /* Dark Mode Styles */
    .dark-mode {
      background-color: #1e1e2f;
      color: #f4f6f9;
    }
    .dark-mode .modal-content {
        background-color: #2c2c3c;
        color: #fff;
    }
    .dark-mode .table {
        color: #f4f6f9;
    }
    .dark-mode .table th {
      background-color: #444;
    }
    .dark-mode .table td {
      border-color: #555;
    }
    .dark-mode .form-control {
        background-color: #2c2c3c;
        border-color: #555;
        color: white;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-primary mb-4">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1"><i class="fas fa-tools"></i> BuildRite Admin</span>
      <button id="toggleDarkMode" class="btn btn-light btn-sm">ðŸŒ™ Dark Mode</button>
    </div>
  </nav>

  <div class="container">
    
    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs mb-4" id="adminTabs">
      <li class="nav-item">
        <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users-section" type="button">
            <i class="fas fa-users"></i> Users
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products-section" type="button">
            <i class="fas fa-box-open"></i> Products Management
        </button>
      </li>
    </ul>

    <div class="tab-content">
      
      <!-- USERS SECTION -->
      <div class="tab-pane fade show active" id="users-section">
        <h2 class="mb-4">Registered Users</h2>
        <div class="search-bar">
          <input type="text" id="userSearchInput" class="form-control" placeholder="Search by name or email..." />
        </div>
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Full Name</th>
                  <th>Email</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="userTableBody"></tbody>
            </table>
        </div>
      </div>

      <!-- PRODUCTS SECTION -->
      <div class="tab-pane fade" id="products-section">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Product Inventory</h2>
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#productModal" onclick="resetProductForm()">
                <i class="fas fa-plus"></i> Add New Product
            </button>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle">
              <thead>
                <tr>
                  <th>Image</th>
                  <th>Product Name</th>
                  <th>Price (â‚±)</th>
                  <th>Description</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="productTableBody"></tbody>
            </table>
        </div>
      </div>

    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Add Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="productForm">
            <input type="hidden" id="editIndex"> <!-- Hidden input to store index if editing -->
            
            <div class="mb-3">
              <label class="form-label">Product Name</label>
              <input type="text" class="form-control" id="prodName" required>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Price (â‚±)</label>
              <input type="number" class="form-control" id="prodPrice" required>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Image Path (e.g., images/tofil.png)</label>
              <input type="text" class="form-control" id="prodImage" value="images/buildrite_chemical.png" required>
              <small class="text-muted">Ensure the image file exists in your project folder.</small>
            </div>

            <div class="mb-3">
              <label class="form-label">Short Description</label>
              <textarea class="form-control" id="prodDesc" rows="2" required></textarea>
            </div>

            <button type="submit" class="btn btn-primary w-100">Save Product</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
     /* PASTE THE JAVASCRIPT FROM PART 3 HERE */

     // --- SHARED VARIABLES ---
    const toggleDarkMode = document.getElementById('toggleDarkMode');
    const body = document.body;

    // --- USER MANAGEMENT LOGIC ---
    const userTableBody = document.getElementById('userTableBody');
    const userSearchInput = document.getElementById('userSearchInput');
    let accounts = JSON.parse(localStorage.getItem('userAccounts')) || [];

    const renderUserTable = (filter = '') => {
      userTableBody.innerHTML = '';
      const filtered = accounts.filter(user =>
        user.name.toLowerCase().includes(filter.toLowerCase()) ||
        user.email.toLowerCase().includes(filter.toLowerCase())
      );

      if(filtered.length === 0) {
        userTableBody.innerHTML = '<tr><td colspan="4" class="text-center">No users found.</td></tr>';
        return;
      }

      filtered.forEach((user, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td><button class="btn btn-danger btn-sm" onclick="deleteUser(${index})"><i class="fas fa-trash"></i> Delete</button></td>
        `;
        userTableBody.appendChild(row);
      });
    };

    const deleteUser = (index) => {
      if (confirm('Are you sure you want to delete this user?')) {
        accounts.splice(index, 1);
        localStorage.setItem('userAccounts', JSON.stringify(accounts));
        renderUserTable(userSearchInput.value);
      }
    };

    userSearchInput.addEventListener('input', () => renderUserTable(userSearchInput.value));


    // --- PRODUCT MANAGEMENT LOGIC ---
    const productTableBody = document.getElementById('productTableBody');
    const productForm = document.getElementById('productForm');
    const modalTitle = document.getElementById('modalTitle');
    let productModalInstance; // To handle Bootstrap modal programmatically

    // Default Products (Seeds the database if empty)
    const defaultProducts = [
        {
            name: "BUILDRITE LEAK PLUG",
            price: 2783,
            image: "images/buildrite_chemical.png",
            description: "Dry powder which only needs water addition to produce an ultra-rapid set plugging mortar."
        },
        {
            name: "BUILDRITE FLEXCRETE 18KG",
            price: 2910,
            image: "images/buildritecrate.png",
            description: "Two component, flexible cementitious waterproofing membrane."
        },
        {
            name: "BUILDRITE TOFIL 801 SKIM COAT",
            price: 471,
            image: "images/tofil.png",
            description: "Finishing compound specially formulated for concrete surfaces."
        },
        {
            name: "BUILDRITE EPOCOAT MB PRIMER",
            price: 2385,
            image: "images/epocoat.png",
            description: "Two component, 100% solids epoxy specially formulated as a high strength binder."
        }
    ];

    // Get Products from LocalStorage OR use defaults
    let products = JSON.parse(localStorage.getItem('buildRiteProducts'));
    if (!products || products.length === 0) {
        products = defaultProducts;
        localStorage.setItem('buildRiteProducts', JSON.stringify(products));
    }

    const renderProductTable = () => {
        productTableBody.innerHTML = '';
        
        products.forEach((prod, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><img src="${prod.image}" alt="Product"></td>
                <td>${prod.name}</td>
                <td>â‚±${prod.price.toLocaleString()}</td>
                <td><small>${prod.description.substring(0, 50)}...</small></td>
                <td>
                    <button class="btn btn-warning btn-sm btn-action" onclick="editProduct(${index})" data-bs-toggle="modal" data-bs-target="#productModal">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm btn-action" onclick="deleteProduct(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            productTableBody.appendChild(row);
        });
    };

    // Add or Save Product
    productForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const name = document.getElementById('prodName').value;
        const price = parseFloat(document.getElementById('prodPrice').value);
        const image = document.getElementById('prodImage').value;
        const desc = document.getElementById('prodDesc').value;
        const index = document.getElementById('editIndex').value;

        const newProduct = { name, price, image, description: desc };

        if (index === "") {
            // Add New
            products.push(newProduct);
        } else {
            // Update Existing
            products[parseInt(index)] = newProduct;
        }

        localStorage.setItem('buildRiteProducts', JSON.stringify(products));
        renderProductTable();
        
        // Close Modal
        const modalEl = document.getElementById('productModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        modal.hide();
        
        productForm.reset();
    });

    // Edit Product Setup
    window.editProduct = (index) => {
        modalTitle.innerText = "Edit Product";
        document.getElementById('editIndex').value = index;
        document.getElementById('prodName').value = products[index].name;
        document.getElementById('prodPrice').value = products[index].price;
        document.getElementById('prodImage').value = products[index].image;
        document.getElementById('prodDesc').value = products[index].description;
    };

    // Reset Form when clicking "Add New"
    window.resetProductForm = () => {
        modalTitle.innerText = "Add Product";
        document.getElementById('editIndex').value = "";
        productForm.reset();
        document.getElementById('prodImage').value = "images/buildrite_chemical.png"; // default placeholder
    };

    // Delete Product
    window.deleteProduct = (index) => {
        if(confirm("Delete this product? It will disappear from the shop.")) {
            products.splice(index, 1);
            localStorage.setItem('buildRiteProducts', JSON.stringify(products));
            renderProductTable();
        }
    };

    // --- INITIALIZATION ---
    toggleDarkMode.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
    });

    // Initial Render
    renderUserTable();
    renderProductTable();
  </script>
</body>
</html>